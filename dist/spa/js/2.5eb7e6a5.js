"use strict";(globalThis["webpackChunkraseed_app"]=globalThis["webpackChunkraseed_app"]||[]).push([[2],{4002:(e,a,l)=>{l.r(a),l.d(a,{default:()=>Ee});l(939),l(6461),l(4520),l(7049);var t=l(1347),o=l(7763),i=l(8633),r=l(4187),n=l(6308),s=l(1400),c=(l(6593),l(176));const d={class:"text-caption"},u={class:"receipt-form-container"},p={class:"receipt-section merchant-section"},m={class:"row q-col-gutter-md"},v={class:"col-12 col-md-6"},g={class:"col-12 col-md-6"},b={class:"receipt-section invoice-section"},f={class:"row q-col-gutter-md"},_={class:"col-12 col-md-4"},k={class:"col-12 col-md-4"},y={class:"row items-center justify-end q-gutter-sm q-pr-md q-pb-md"},h={class:"col-12 col-md-4"},F={class:"col-12 col-md-4"},w={class:"col-12 col-md-4"},x={class:"col-12 col-md-4"},C={class:"receipt-section items-section"},V={class:"receipt-section-title"},A={class:"items-table"},L={class:"receipt-section taxes-section"},q={class:"receipt-section-title"},R={class:"taxes-table"},U={class:"receipt-section payment-section"},E={class:"row q-col-gutter-md"},D={class:"col-12 col-md-4"},Q={class:"col-12 col-md-4"},I={class:"col-12 col-md-4"},P={__name:"ReceiptEditor",props:{receipt:{type:Object,required:!1,default:()=>null},isOpen:{type:Boolean,default:!1}},emits:["update:isOpen","save","cancel"],setup(e,{emit:a}){const l=e,i=a,n=(0,r.KR)({merchant_name:"",merchant_gstin:"",invoice_date:"",invoice_number:"",invoice_place_of_supply:"",platform_name:"",taxes:[],total_amount:0,currency:"INR",payment_method:"",language:"English",customer_name:"",category_name:"",metadata:{items:[],raw_text_extracted:""}});(0,t.wB)(()=>l.receipt,e=>{e&&(e.error||(n.value=JSON.parse(JSON.stringify({...e.extracted,metadata:{...e.extracted.metadata}})),n.value.metadata.items=n.value.metadata?.items?.map(e=>({...e,id:(0,c.A)()}))||[],n.value.taxes=n.value.taxes?.map(e=>({...e,id:(0,c.A)()}))||[]))},{deep:!0,immediate:!0});const s=[{name:"name",label:"Item Name",field:"name",align:"left"},{name:"quantity",label:"Qty",field:"quantity",align:"right"},{name:"price_per_unit",label:"Price/Unit",field:"price_per_unit",align:"right"},{name:"price",label:"Total",field:"price",align:"right"},{name:"actions",label:"",field:"actions",align:"center"}],P=[{name:"name",label:"Tax Name",field:"name",align:"left"},{name:"rate",label:"Rate %",field:"rate",align:"right"},{name:"amount",label:"Amount",field:"amount",align:"right"},{name:"actions",label:"",field:"actions",align:"center"}],S=["CASH","CREDIT_CARD","DEBIT_CARD","UPI","NETBANKING","WALLET","CHEQUE","OTHER"],K=["INR","USD","EUR","GBP","AED","SGD"],T=["Dining & Food Delivery","Groceries","Shopping","Travel","Utilities","Entertainment","Health & Medical","Education","Business Expenses","Others"];function W(){n.value.metadata.items.push({id:(0,c.A)(),name:"",quantity:1,price_per_unit:0,price:0})}function O(e){n.value.metadata.items.splice(e,1),Y()}function N(){n.value.taxes.push({id:(0,c.A)(),name:"",rate:null,amount:0})}function X(e){n.value.taxes.splice(e,1),Y()}function z(e){e.quantity&&e.price_per_unit&&(e.price=parseFloat((e.quantity*e.price_per_unit).toFixed(2))),Y()}function $(e){e.quantity&&e.price&&(e.price_per_unit=parseFloat((e.price/e.quantity).toFixed(2))),Y()}function M(e){if(null!==e.rate){const a=n.value.metadata.items.reduce((e,a)=>e+(a.price||0),0);e.amount=parseFloat((a*e.rate/100).toFixed(2))}}function Y(){const e=n.value.metadata.items.reduce((e,a)=>e+(a.price||0),0),a=n.value.taxes.reduce((e,a)=>e+(a.amount||0),0);n.value.total_amount=parseFloat((e+a).toFixed(2))}function G(){if(!l.receipt)return console.error("Cannot save: Receipt data is null"),void i("update:isOpen",!1);const e=l.receipt.identifier,a={extracted:{...n.value,metadata:{...n.value.metadata,raw_text_extracted:l.receipt.extracted?.metadata?.raw_text_extracted||""}}};a.extracted.taxes&&a.extracted.taxes.forEach(e=>delete e.id),a.extracted.metadata&&a.extracted.metadata.items&&a.extracted.metadata.items.forEach(e=>delete e.id),i("save",{identifier:e,data:a}),i("update:isOpen",!1)}function j(){i("cancel"),i("update:isOpen",!1)}function B(e){if(!e)return"Unknown error";if("string"===typeof e&&(e.includes("{")||e.includes("}")))try{if(e.includes("message")){const a=e.match(/'message':\s*'([^']+)'/);if(a&&a[1])return a[1].split(".")[0]}return"Processing error. Please try again later."}catch(a){return e.substring(0,100)+(e.length>100?"...":"")}return e}return(a,l)=>{const i=(0,t.g2)("q-card-section"),r=(0,t.g2)("q-banner"),c=(0,t.g2)("q-separator"),Y=(0,t.g2)("q-btn"),H=(0,t.g2)("q-card-actions"),J=(0,t.g2)("q-space"),Z=(0,t.g2)("q-input"),ee=(0,t.g2)("q-date"),ae=(0,t.g2)("q-popup-proxy"),le=(0,t.g2)("q-icon"),te=(0,t.g2)("q-select"),oe=(0,t.g2)("q-td"),ie=(0,t.g2)("q-tr"),re=(0,t.g2)("q-table"),ne=(0,t.g2)("q-card"),se=(0,t.g2)("q-dialog"),ce=(0,t.gN)("close-popup");return(0,t.uX)(),(0,t.Wv)(se,{"model-value":e.isOpen,"onUpdate:modelValue":l[15]||(l[15]=e=>a.$emit("update:isOpen",e)),persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,t.k6)(()=>[(0,t.bF)(ne,{class:"receipt-editor-card"},{default:(0,t.k6)(()=>[e.receipt&&e.receipt.error?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bF)(i,{class:"bg-negative text-white"},{default:(0,t.k6)(()=>l[16]||(l[16]=[(0,t.Lk)("div",{class:"text-h6"},"Receipt Processing Error",-1)])),_:1,__:[16]}),(0,t.bF)(i,{class:"q-pa-md"},{default:(0,t.k6)(()=>[l[17]||(l[17]=(0,t.Lk)("p",{class:"text-body1 q-mb-md"},"We encountered an error while processing this receipt:",-1)),(0,t.bF)(r,{class:"bg-grey-3 q-pa-md"},{default:(0,t.k6)(()=>[(0,t.Lk)("pre",d,(0,o.v_)(B(e.receipt.error)),1)]),_:1})]),_:1,__:[17]}),(0,t.bF)(c),(0,t.bF)(H,{align:"right",class:"bg-white"},{default:(0,t.k6)(()=>[(0,t.bo)((0,t.bF)(Y,{flat:"",label:"Close",color:"primary",onClick:l[0]||(l[0]=e=>a.$emit("cancel"))},null,512),[[ce]])]),_:1})],64)):e.receipt?((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.bF)(i,{class:"receipt-editor-header"},{default:(0,t.k6)(()=>[l[18]||(l[18]=(0,t.Lk)("div",{class:"text-h6"},"Edit Receipt Details",-1)),(0,t.bF)(J),(0,t.bo)((0,t.bF)(Y,{icon:"close",flat:"",round:"",dense:"",onClick:j},null,512),[[ce]])]),_:1,__:[18]}),(0,t.bF)(c),(0,t.bF)(i,{class:"receipt-editor-content q-pa-md"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",u,[(0,t.Lk)("div",p,[l[19]||(l[19]=(0,t.Lk)("div",{class:"receipt-section-title"},"Merchant Information",-1)),(0,t.Lk)("div",m,[(0,t.Lk)("div",v,[(0,t.bF)(Z,{filled:"",modelValue:n.value.merchant_name,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value.merchant_name=e),label:"Merchant Name",rules:[e=>!!e||"Field is required"]},null,8,["modelValue","rules"])]),(0,t.Lk)("div",g,[(0,t.bF)(Z,{filled:"",modelValue:n.value.merchant_gstin,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value.merchant_gstin=e),label:"GSTIN",hint:"15-digit GST Identification Number",mask:"## AAAAA#### A #A#"},null,8,["modelValue"])])])]),(0,t.Lk)("div",b,[l[20]||(l[20]=(0,t.Lk)("div",{class:"receipt-section-title"},"Invoice Information",-1)),(0,t.Lk)("div",f,[(0,t.Lk)("div",_,[(0,t.bF)(Z,{filled:"",modelValue:n.value.invoice_number,"onUpdate:modelValue":l[3]||(l[3]=e=>n.value.invoice_number=e),label:"Invoice Number"},null,8,["modelValue"])]),(0,t.Lk)("div",k,[(0,t.bF)(Z,{filled:"",modelValue:n.value.invoice_date,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.invoice_date=e),label:"Invoice Date",mask:"####-##-##",hint:"YYYY-MM-DD",clearable:"",onClick:l[6]||(l[6]=e=>a.$refs.qDateProxy.show())},{append:(0,t.k6)(()=>[(0,t.bF)(le,{name:"event",class:"cursor-pointer"},{default:(0,t.k6)(()=>[(0,t.bF)(ae,{ref:"qDateProxy",cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.k6)(()=>[(0,t.bF)(ee,{modelValue:n.value.invoice_date,"onUpdate:modelValue":l[4]||(l[4]=e=>n.value.invoice_date=e),mask:"YYYY-MM-DD","today-btn":""},{default:(0,t.k6)(()=>[(0,t.Lk)("div",y,[(0,t.bo)((0,t.bF)(Y,{label:"Cancel",color:"grey-7",flat:""},null,512),[[ce]]),(0,t.bo)((0,t.bF)(Y,{label:"OK",color:"primary",flat:""},null,512),[[ce]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),(0,t.Lk)("div",h,[(0,t.bF)(Z,{filled:"",modelValue:n.value.invoice_place_of_supply,"onUpdate:modelValue":l[7]||(l[7]=e=>n.value.invoice_place_of_supply=e),label:"Place of Supply"},null,8,["modelValue"])]),(0,t.Lk)("div",F,[(0,t.bF)(Z,{filled:"",modelValue:n.value.platform_name,"onUpdate:modelValue":l[8]||(l[8]=e=>n.value.platform_name=e),label:"Platform",hint:"e.g. Zomato, Amazon, etc."},null,8,["modelValue"])]),(0,t.Lk)("div",w,[(0,t.bF)(te,{filled:"",modelValue:n.value.payment_method,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.payment_method=e),options:S,label:"Payment Method"},null,8,["modelValue"])]),(0,t.Lk)("div",x,[(0,t.bF)(te,{filled:"",modelValue:n.value.category_name,"onUpdate:modelValue":l[10]||(l[10]=e=>n.value.category_name=e),options:T,label:"Category"},null,8,["modelValue"])])])]),(0,t.Lk)("div",C,[(0,t.Lk)("div",V,[l[21]||(l[21]=(0,t.eW)(" Items ",-1)),(0,t.bF)(Y,{round:"",flat:"",dense:"",icon:"add",color:"primary",size:"sm",onClick:W,class:"q-ml-sm"})]),(0,t.Lk)("div",A,[(0,t.bF)(re,{rows:n.value.metadata.items,columns:s,"row-key":"id",flat:"",bordered:"","hide-pagination":"",pagination:{rowsPerPage:0}},{body:(0,t.k6)(e=>[(0,t.bF)(ie,{props:e},{default:(0,t.k6)(()=>[(0,t.bF)(oe,{key:"name",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{modelValue:e.row.name,"onUpdate:modelValue":a=>e.row.name=a,dense:"",outlined:"",class:"no-border-input",placeholder:"Item name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),(0,t.bF)(oe,{key:"quantity",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{modelValue:e.row.quantity,"onUpdate:modelValue":[a=>e.row.quantity=a,a=>z(e.row)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"no-border-input",placeholder:"Qty"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),(0,t.bF)(oe,{key:"price_per_unit",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{modelValue:e.row.price_per_unit,"onUpdate:modelValue":[a=>e.row.price_per_unit=a,a=>z(e.row)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"no-border-input",placeholder:"Price/unit"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),(0,t.bF)(oe,{key:"price",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{modelValue:e.row.price,"onUpdate:modelValue":[a=>e.row.price=a,a=>$(e.row)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"no-border-input",placeholder:"Total price"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),(0,t.bF)(oe,{key:"actions",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Y,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:a=>O(e.rowIndex)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])])]),(0,t.Lk)("div",L,[(0,t.Lk)("div",q,[l[22]||(l[22]=(0,t.eW)(" Taxes & Charges ",-1)),(0,t.bF)(Y,{round:"",flat:"",dense:"",icon:"add",color:"primary",size:"sm",onClick:N,class:"q-ml-sm"})]),(0,t.Lk)("div",R,[(0,t.bF)(re,{rows:n.value.taxes,columns:P,"row-key":"id",flat:"",bordered:"","hide-pagination":"",pagination:{rowsPerPage:0}},{body:(0,t.k6)(e=>[(0,t.bF)(ie,{props:e},{default:(0,t.k6)(()=>[(0,t.bF)(oe,{key:"name",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{modelValue:e.row.name,"onUpdate:modelValue":a=>e.row.name=a,dense:"",outlined:"",class:"no-border-input",placeholder:"Tax name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),(0,t.bF)(oe,{key:"rate",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{modelValue:e.row.rate,"onUpdate:modelValue":[a=>e.row.rate=a,a=>M(e.row)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"no-border-input",placeholder:"Rate %"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),(0,t.bF)(oe,{key:"amount",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{modelValue:e.row.amount,"onUpdate:modelValue":a=>e.row.amount=a,modelModifiers:{number:!0},type:"number",dense:"",outlined:"",class:"no-border-input",placeholder:"Amount"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),(0,t.bF)(oe,{key:"actions",props:e},{default:(0,t.k6)(()=>[(0,t.bF)(Y,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:a=>X(e.rowIndex)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])])]),(0,t.Lk)("div",U,[l[23]||(l[23]=(0,t.Lk)("div",{class:"receipt-section-title"},"Payment Details",-1)),(0,t.Lk)("div",E,[(0,t.Lk)("div",D,[(0,t.bF)(Z,{filled:"",modelValue:n.value.total_amount,"onUpdate:modelValue":l[11]||(l[11]=e=>n.value.total_amount=e),modelModifiers:{number:!0},type:"number",label:"Total Amount",prefix:"â‚¹"},null,8,["modelValue"])]),(0,t.Lk)("div",Q,[(0,t.bF)(te,{filled:"",modelValue:n.value.currency,"onUpdate:modelValue":l[12]||(l[12]=e=>n.value.currency=e),options:K,label:"Currency"},null,8,["modelValue"])]),(0,t.Lk)("div",I,[(0,t.bF)(Z,{filled:"",modelValue:n.value.customer_name,"onUpdate:modelValue":l[13]||(l[13]=e=>n.value.customer_name=e),label:"Customer Name"},null,8,["modelValue"])])])])])]),_:1}),(0,t.bF)(c),(0,t.bF)(H,{align:"right",class:"bg-white"},{default:(0,t.k6)(()=>[(0,t.bo)((0,t.bF)(Y,{flat:"",label:"Cancel",color:"negative",onClick:j},null,512),[[ce]]),(0,t.bF)(Y,{flat:"",label:"Save",color:"primary",onClick:G})]),_:1})],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:2},[(0,t.bF)(i,{class:"bg-grey-2"},{default:(0,t.k6)(()=>l[24]||(l[24]=[(0,t.Lk)("div",{class:"text-h6 text-center"},"No Receipt Data",-1),(0,t.Lk)("p",{class:"text-center"},"No receipt data is available to edit.",-1)])),_:1,__:[24]}),(0,t.bF)(H,{align:"right",class:"bg-white"},{default:(0,t.k6)(()=>[(0,t.bo)((0,t.bF)(Y,{flat:"",label:"Close",color:"primary",onClick:l[14]||(l[14]=e=>a.$emit("cancel"))},null,512),[[ce]])]),_:1})],64))]),_:1})]),_:1},8,["model-value"])}}};var S=l(2968),K=l(2540),T=l(3341),W=l(222),O=l(7453),N=l(6915),X=l(5034),z=l(9039),$=l(5873),M=l(6067),Y=l(5626),G=l(3933),j=l(8360),B=l(9549),H=l(6194),J=l(7339),Z=l(8785),ee=l(7861),ae=l(8657),le=l(272),te=l.n(le);const oe=(0,S.A)(P,[["__scopeId","data-v-4e92b74a"]]),ie=oe;te()(P,"components",{QDialog:K.A,QCard:T.A,QCardSection:W.A,QBanner:O.A,QSeparator:N.A,QCardActions:X.A,QBtn:z.A,QSpace:$.A,QInput:M.A,QDate:Y.A,QIcon:G.A,QPopupProxy:j.A,QSelect:B.A,QTable:H.A,QTr:J.A,QTd:Z.A,QField:ee.A}),te()(P,"directives",{ClosePopup:ae.A});var re=l(455);const ne={class:"receipt-upload-container"},se={key:0},ce={key:1,class:"receipt-camera-feed"},de={key:2,class:"receipt-drop-content"},ue={class:"receipt-drop-icons"},pe={class:"receipt-action-row"},me={key:0,style:{"margin-left":"6px",display:"inline-flex","align-items":"center"}},ve={style:{"font-size":"0.82em",color:"#10b981","font-weight":"600"}},ge={key:1,style:{"margin-left":"8px",display:"inline-flex","align-items":"center"}},be={style:{"font-size":"0.82em",color:"#e11d48","font-weight":"600"}},fe={key:0,style:{"font-size":"0.82em",color:"#10b981","margin-left":"6px","font-weight":"600"}},_e={key:0,class:"receipt-preview-row"},ke={key:1,class:"receipt-preview-pdf"},ye={class:"receipt-preview-name"},he={key:1,class:"text-negative text-center q-mt-md"},Fe={key:1,class:"receipt-history-section"},we={class:"column items-center col-auto q-mr-md"},xe={class:"col text-h6"},Ce={class:"text-body1 q-mb-sm"},Ve={class:"text-caption text-grey-8"},Ae={class:"text-center"},Le={__name:"CreateRaseedPage",setup(e){const a=(0,r.KR)([]),l=(0,r.KR)(!1),c=(0,r.KR)(""),d=(0,r.KR)(!1),u=(0,r.KR)(null),p=(0,r.KR)(!1),m=(0,r.KR)("image"),v=(0,r.KR)(null),g=(0,r.KR)(null),b=(0,r.KR)([]),f=(0,r.KR)(null),_=(0,r.KR)(!1),k=(0,r.KR)(!1),y=(0,r.KR)(""),h=(0,r.KR)([]),F=(0,re.rd)(),w=(0,t.EW)(()=>a.value.filter(e=>e.type&&e.type.startsWith("image/")).length),x=(0,t.EW)(()=>a.value.filter(e=>"application/pdf"===e.type).length),C=(0,t.EW)(()=>b.value.length);function V(){try{const e=localStorage.getItem("raseed_receipt_ids");if(e){const a=JSON.parse(e);Array.isArray(a)&&(h.value=a)}}catch(e){console.error("Error loading saved receipt IDs",e)}}function A(e){try{const a=[...h.value];a.includes(e)||(a.push(e),h.value=a,localStorage.setItem("raseed_receipt_ids",JSON.stringify(a)))}catch(e){console.error("Error saving receipt ID",e)}}function L(e){const l=a.value[e];l.preview&&URL.revokeObjectURL(l.preview),a.value.splice(e,1);const t=b.value.findIndex(e=>e.id===l.id);-1!==t&&b.value.splice(t,1)}function q(){u.value.click()}function R(e){E([...e.target.files]),e.target.value=""}function U(e){d.value=!1,E([...e.dataTransfer.files])}function E(e){const l=e.map(e=>({file:e,id:`${e.name}-${e.size}-${Date.now()}`,name:e.name,type:e.type,preview:e.type.startsWith("image/")?URL.createObjectURL(e):void 0}));a.value=[...a.value,...l]}async function D(e){m.value=e,p.value=!0,await(0,t.dY)();try{v.value=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),g.value.srcObject=v.value}catch(e){c.value="Unable to access camera: "+e.message,p.value=!1}}function Q(){v.value&&(v.value.getTracks().forEach(e=>e.stop()),v.value=null),p.value=!1,b.value=[]}async function I(){const e=g.value,l=document.createElement("canvas");l.width=e.videoWidth,l.height=e.videoHeight;const t=l.getContext("2d");t.drawImage(e,0,0,l.width,l.height),l.toBlob(e=>{if(e){const l=new File([e],`photo-${Date.now()}.png`,{type:"image/png"}),t={file:l,id:`${l.name}-${l.size}-${Date.now()}`,name:l.name,type:l.type,preview:URL.createObjectURL(l)};a.value.push(t),b.value.push(t)}},"image/png")}async function P(){if(0!==a.value.length){l.value=!0,c.value="";try{const e=new FormData,l=s.Z.user?.sub||s.Z.user?.google_id||"unknown-user",t=Date.now(),o=`${l}-${t}`;e.append("identifier",o),a.value.forEach((a,l)=>{e.append("files",a.file)});const i=await n.A.post("/receipts/upload",e,{headers:{"Content-Type":"multipart/form-data"}});if(console.log("Receipt upload response:",i.data),i.data.error)throw{response:{data:{error:i.data.error}}};f.value=i.data,y.value=o,A(o),_.value=!0,a.value=[]}catch(e){if(console.error("Error uploading receipts:",e),e.response?.data?.error){const a=e.response.data.error;if(a.includes("RESOURCE_EXHAUSTED")&&a.includes("exceeded your current quota"))return void W({title:"AI Service Limit Reached",message:"Our AI service has reached its processing limit. Please try again later.",details:"The Google Gemini API has a daily limit on free tier usage. You can try again tomorrow.",icon:"schedule",color:"amber-8"});if(a.includes("Failed to perform OCR"))return void W({title:"Receipt Processing Issue",message:"We had trouble reading your receipt. Please try with a clearer image.",details:"Make sure the receipt is well-lit and text is clearly visible.",icon:"image_not_supported",color:"deep-orange"});c.value="Upload failed: "+S(a)}else c.value="Failed to upload receipts. Please try again."}finally{l.value=!1}}else c.value="Please select at least one file to upload"}function S(e){if("string"===typeof e&&(e.includes("{")||e.includes("}")))try{if(e.includes("message")){const a=e.match(/'message':\s*'([^']+)'/);if(a&&a[1])return a[1].split(".")[0]}return"Processing error. Please try again later."}catch(a){return e.substring(0,100)+(e.length>100?"...":"")}return e}(0,t.sV)(()=>{V()}),(0,t.xo)(()=>{a.value.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),v.value&&(v.value.getTracks().forEach(e=>e.stop()),v.value=null)});const K=(0,r.KR)(!1),T=(0,r.KR)({title:"",message:"",details:"",icon:"",color:""});function W(e){T.value=e,K.value=!0}function O(){f.value=null,_.value=!1}async function N(e){l.value=!0,c.value="";try{const{identifier:a,data:l}=e,t=await n.A.post(`/receipts/save?identifier=${a}`,l);t.data&&t.data.add_to_wallet_url?(z.value={receipt_id:t.data.receipt_id,add_to_wallet_url:t.data.add_to_wallet_url},X.value=!0):(T.value={title:"Receipt Saved",message:"Your receipt has been successfully saved.",details:"",icon:"check_circle",color:"positive"},K.value=!0,setTimeout(()=>{K.value=!1,f.value=null,_.value=!1},1500))}catch(e){console.error("Error saving receipt data:",e),W({title:"Save Failed",message:"We couldn't save your receipt data.",details:e.response?.data?.message||e.message||"Please try again.",icon:"error",color:"negative"})}finally{l.value=!1}}const X=(0,r.KR)(!1),z=(0,r.KR)({receipt_id:null,add_to_wallet_url:""});function $(){window.open(z.value.add_to_wallet_url,"_blank"),M()}function M(){X.value=!1,f.value=null,_.value=!1,F.push("/create-raseed")}return(e,r)=>{const n=(0,t.g2)("q-btn"),s=(0,t.g2)("q-icon"),v=(0,t.g2)("q-img"),b=(0,t.g2)("q-space"),y=(0,t.g2)("q-card-section"),h=(0,t.g2)("q-card-actions"),F=(0,t.g2)("q-card"),V=(0,t.g2)("q-dialog"),A=(0,t.g2)("q-page"),E=(0,t.gN)("close-popup");return(0,t.uX)(),(0,t.Wv)(A,{class:"flex flex-center bg-grey-1"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",ne,[f.value?k.value?((0,t.uX)(),(0,t.CE)("div",Fe)):(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",se,[(0,t.Lk)("div",{class:(0,o.C4)(["receipt-drop-area",{active:d.value}]),onDragover:r[0]||(r[0]=(0,i.D$)(e=>d.value=!0,["prevent"])),onDragleave:r[1]||(r[1]=(0,i.D$)(e=>d.value=!1,["prevent"])),onDrop:(0,i.D$)(U,["prevent"]),onClick:r[2]||(r[2]=e=>!p.value&&q()),style:{"user-select":"none"}},[p.value?((0,t.uX)(),(0,t.Wv)(n,{key:0,icon:"close",round:"",unelevated:"",color:"grey-8",class:"receipt-camera-close-btn",onClick:(0,i.D$)(Q,["stop"]),"aria-label":"Close camera"})):(0,t.Q3)("",!0),p.value?((0,t.uX)(),(0,t.CE)("div",ce,[(0,t.Lk)("video",{ref_key:"cameraVideo",ref:g,autoplay:"",playsinline:"",class:"receipt-camera-video"},null,512)])):((0,t.uX)(),(0,t.CE)("div",de,[(0,t.Lk)("div",ue,[(0,t.bF)(s,{name:"photo_camera",color:"primary",size:"40px",class:"receipt-drop-icon"}),(0,t.bF)(s,{name:"description",color:"purple",size:"40px",class:"receipt-drop-icon"}),(0,t.bF)(s,{name:"picture_as_pdf",color:"red",size:"40px",class:"receipt-drop-icon"})]),r[7]||(r[7]=(0,t.Lk)("div",{class:"receipt-drop-title"},"Add your receipts",-1)),r[8]||(r[8]=(0,t.Lk)("div",{class:"receipt-drop-desc"},[(0,t.eW)(" Click to select images or PDFs, "),(0,t.Lk)("br"),(0,t.eW)(" or drag files here ")],-1))])),(0,t.Lk)("input",{ref_key:"fileInput",ref:u,type:"file",multiple:"",accept:"image/*,application/pdf",class:"hidden",onChange:R},null,544)],34),(0,t.Lk)("div",pe,[p.value?p.value&&"image"===m.value?((0,t.uX)(),(0,t.Wv)(n,{key:1,flat:"",class:"receipt-action-btn",color:"primary",icon:"photo_camera",onClick:I},{default:(0,t.k6)(()=>[r[10]||(r[10]=(0,t.eW)(" Capture ",-1)),C.value>0?((0,t.uX)(),(0,t.CE)("span",fe," ("+(0,o.v_)(C.value)+") ",1)):(0,t.Q3)("",!0)]),_:1,__:[10]})):(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(n,{key:0,flat:"",class:"receipt-action-btn",onClick:r[3]||(r[3]=e=>D("image"))},{default:(0,t.k6)(()=>[(0,t.bF)(s,{name:"photo_camera",class:"q-mr-sm"}),r[9]||(r[9]=(0,t.eW)(" Photo ",-1)),w.value>0?((0,t.uX)(),(0,t.CE)("span",me,[(0,t.bF)(s,{name:"photo",size:"16px",color:"primary",style:{"margin-right":"2px"}}),(0,t.Lk)("span",ve,(0,o.v_)(w.value),1)])):(0,t.Q3)("",!0),x.value>0?((0,t.uX)(),(0,t.CE)("span",ge,[(0,t.bF)(s,{name:"picture_as_pdf",size:"16px",color:"red",style:{"margin-right":"2px"}}),(0,t.Lk)("span",be,(0,o.v_)(x.value),1)])):(0,t.Q3)("",!0)]),_:1,__:[9]}))]),a.value.length?((0,t.uX)(),(0,t.CE)("div",_e,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.value,(a,l)=>((0,t.uX)(),(0,t.CE)("div",{key:a.id,class:"receipt-preview-item"},[(0,t.bF)(n,{dense:"",flat:"",round:"",icon:"close",color:"negative",size:"sm",class:"receipt-remove-btn",onClick:e=>L(l),"aria-label":"Remove file",style:{position:"absolute",top:"2px",right:"2px","z-index":"2"}},null,8,["onClick"]),a.type&&a.type.startsWith("image/")?((0,t.uX)(),(0,t.Wv)(v,{key:0,src:a.preview,alt:a.name,class:"receipt-preview-thumb"},null,8,["src","alt"])):"application/pdf"===a.type?((0,t.uX)(),(0,t.CE)("div",ke,[(0,t.bF)(s,{name:"picture_as_pdf",color:"red",size:"48px"}),(0,t.Lk)("div",ye,(0,o.v_)(e.crispName(a.name)),1)])):(0,t.Q3)("",!0)]))),128))])):(0,t.Q3)("",!0),(0,t.bF)(n,{class:"receipt-upload-btn",loading:l.value,disable:0===a.value.length,onClick:P},{default:(0,t.k6)(()=>r[11]||(r[11]=[(0,t.eW)(" Upload & Analyze ",-1)])),_:1,__:[11]},8,["loading","disable"]),c.value?((0,t.uX)(),(0,t.CE)("div",he,(0,o.v_)(c.value),1)):(0,t.Q3)("",!0)]))]),(0,t.bF)(ie,{receipt:f.value,"is-open":_.value,"onUpdate:isOpen":r[4]||(r[4]=e=>_.value=e),onSave:N,onCancel:O},null,8,["receipt","is-open"]),(0,t.bF)(V,{modelValue:K.value,"onUpdate:modelValue":r[5]||(r[5]=e=>K.value=e)},{default:(0,t.k6)(()=>[(0,t.bF)(F,{class:"error-dialog-card"},{default:(0,t.k6)(()=>[(0,t.bF)(y,{class:"row items-center"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",we,[(0,t.bF)(s,{name:T.value.icon||"error",color:T.value.color||"negative",size:"48px"},null,8,["name","color"])]),(0,t.Lk)("div",xe,(0,o.v_)(T.value.title),1),(0,t.bF)(b),(0,t.bo)((0,t.bF)(n,{icon:"close",flat:"",round:"",dense:""},null,512),[[E]])]),_:1}),(0,t.bF)(y,null,{default:(0,t.k6)(()=>[(0,t.Lk)("p",Ce,(0,o.v_)(T.value.message),1),(0,t.Lk)("p",Ve,(0,o.v_)(T.value.details),1)]),_:1}),(0,t.bF)(h,{align:"right"},{default:(0,t.k6)(()=>[(0,t.bo)((0,t.bF)(n,{flat:"",label:"Try Again",color:"primary"},null,512),[[E]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,t.bF)(V,{modelValue:X.value,"onUpdate:modelValue":r[6]||(r[6]=e=>X.value=e),persistent:""},{default:(0,t.k6)(()=>[(0,t.bF)(F,{class:"wallet-dialog-card"},{default:(0,t.k6)(()=>[(0,t.bF)(y,{class:"row items-center bg-primary text-white"},{default:(0,t.k6)(()=>[r[12]||(r[12]=(0,t.Lk)("div",{class:"text-h6"},"Receipt Saved Successfully!",-1)),(0,t.bF)(b),(0,t.bF)(n,{icon:"close",flat:"",round:"",dense:"",onClick:M})]),_:1,__:[12]}),(0,t.bF)(y,{class:"q-pt-lg q-px-lg"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",Ae,[(0,t.bF)(s,{name:"check_circle",color:"positive",size:"64px"}),r[14]||(r[14]=(0,t.Lk)("p",{class:"text-h6 q-mt-md"},"Your receipt has been processed",-1)),r[15]||(r[15]=(0,t.Lk)("p",{class:"text-body1 q-mb-lg"},"Add this receipt to Google Wallet for easy access",-1)),(0,t.Lk)("a",{href:"javascript:void(0)",onClick:$,class:"google-wallet-button"},r[13]||(r[13]=[(0,t.Lk)("div",{class:"google-wallet-button-content"},[(0,t.Lk)("img",{src:"https://lh3.googleusercontent.com/8lpANuj1pRxX98RKx1AbAz74EP8jnUirTvlGHFwN9HKY_CyOgon_PC5SH3_kWLh_KQ=w96-rw",alt:"Google Wallet",class:"google-wallet-logo"}),(0,t.Lk)("span",null,"Add to Google Wallet")],-1)]))])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};var qe=l(5013),Re=l(7472);const Ue=(0,S.A)(Le,[["__scopeId","data-v-be28bf70"]]),Ee=Ue;te()(Le,"components",{QPage:qe.A,QBtn:z.A,QIcon:G.A,QImg:Re.A,QDialog:K.A,QCard:T.A,QCardSection:W.A,QSpace:$.A,QCardActions:X.A}),te()(Le,"directives",{ClosePopup:ae.A})},6308:(e,a,l)=>{l.d(a,{A:()=>n});var t=l(9100);const o="http://localhost:8000/api/v1",i=!1,r=t.A.create({baseURL:o});r.interceptors.request.use(e=>{if(!i){const a=localStorage.getItem("sessionToken");a&&(e.headers.Authorization=`Bearer ${a}`)}return e},e=>Promise.reject(e));const n=r}}]);