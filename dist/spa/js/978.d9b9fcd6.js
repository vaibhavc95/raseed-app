"use strict";(globalThis["webpackChunkraseed_app"]=globalThis["webpackChunkraseed_app"]||[]).push([[978],{2978:(e,t,a)=>{a.r(t),a.d(t,{default:()=>se});a(939),a(7855),a(4520),a(7049),a(6593);var l=a(1347),n=a(7763),s=a(4187),o=a(6308),r=a(2535),i=a(891);const c={key:0,class:"insights-container"},d={class:"row q-col-gutter-md q-mb-lg"},u={class:"col-12 col-md-4"},v={class:"text-h4 q-mt-sm text-weight-bold"},m={class:"q-ml-xs"},p={class:"stats-icon bg-green-7"},g={class:"col-12 col-md-4"},y={class:"text-h4 q-mt-sm text-weight-bold"},b={class:"trend-indicator q-mt-xs text-positive"},h={class:"stats-icon bg-blue-7"},_={class:"col-12 col-md-4"},k={class:"text-h4 q-mt-sm text-weight-bold"},f={class:"stats-icon bg-purple-7"},x={class:"row q-col-gutter-md q-mb-lg"},L={class:"col-12 col-lg-7"},F={class:"row items-center"},w={class:"chart-container q-mt-md",style:{height:"300px"}},q={class:"col-12 col-lg-5"},A={class:"row items-center"},C={class:"chart-container q-mt-md",style:{height:"300px"}},S={class:"categories-legend"},D={class:"category-name"},E={class:"category-amount"},Q={key:0,class:"row q-mb-lg"},R={class:"col-12"},I={class:"row items-center"},T={class:"anomalies-container"},W={class:"anomaly-stats"},M={class:"anomaly-chart"},z={class:"anomaly-difference"},$={class:"text-negative"},K={key:1,class:"full-width flex flex-center",style:{height:"400px"}},P={__name:"InsightsPage",setup(e){const t=(0,s.KR)(!0),a=(0,s.KR)("monthly"),P=(0,s.KR)(null),X=(0,s.KR)(284.5),U=(0,s.KR)(null),Y=(0,s.KR)(null);let N=null,V=null;const B=["#1abc9c","#3498db","#f39c12","#9b59b6","#e74c3c","#2ecc71","#34495e","#16a085","#2980b9","#f1c40f"],j=(0,l.EW)(()=>P.value?.total?.[0]?.count||0),G=(0,l.EW)(()=>{if(!P.value?.monthly)return 0;const e=P.value.monthly[0];return e?e.total_spend:0}),O=(0,l.EW)(()=>P.value?.monthly_pie||[]),Z=(0,l.EW)(()=>{if(!P.value?.monthly||P.value.monthly.length<2)return{text:"0%",icon:"trending_flat",color:"text-grey-7"};const e=P.value.monthly[0].total_spend,t=P.value.monthly[1].total_spend;if(0===t)return{text:"0%",icon:"trending_flat",color:"text-grey-7"};const a=(e-t)/t*100,l=a.toFixed(1);return a>0?{text:`+${l}%`,icon:"trending_up",color:"text-negative"}:a<0?{text:`${l}%`,icon:"trending_down",color:"text-positive"}:{text:"0%",icon:"trending_flat",color:"text-grey-7"}});function H(e){return new Intl.NumberFormat("en-IN",{maximumFractionDigits:2,minimumFractionDigits:0}).format(e)}async function J(){t.value=!0;try{const e=await o.A.get("/trends/daily");P.value=e.data,ee()}catch(e){console.error("Error fetching insights data:",e)}finally{t.value=!1}}function ee(){(0,l.dY)(()=>{U.value&&Y.value?(te(),ae()):setTimeout(()=>{te(),ae()},200)})}function te(){if(N&&N.destroy(),!U.value)return void console.error("Spending chart canvas not found");const e=U.value.getContext("2d");let t=[],l=[];if(!e)return void console.error("Failed to get 2D context for spending chart");let n=e.createLinearGradient(0,0,0,350);if(n.addColorStop(0,"rgba(46, 204, 113, 0.6)"),n.addColorStop(1,"rgba(46, 204, 113, 0.1)"),P.value){if("daily"===a.value&&P.value.daily?(t=P.value.daily.map(e=>{const t=new Date(e.period);return t.toLocaleDateString("en-US",{day:"numeric",month:"short"})}),l=P.value.daily.map(e=>e.total_spend)):"monthly"===a.value&&P.value.monthly?(t=P.value.monthly.map(e=>e.month_name),l=P.value.monthly.map(e=>e.total_spend)):"yearly"===a.value&&P.value.yearly&&(t=P.value.yearly.map(e=>e.year),l=P.value.yearly.map(e=>e.total_spend)),"weekly"===a.value&&P.value.daily&&P.value.daily.length>0){const e=[];for(let t=0;t<P.value.daily.length;t+=7){const a=P.value.daily.slice(t,t+7);if(a.length>0){const t=a.reduce((e,t)=>e+t.total_spend,0),l=new Date(a[0].period),n=new Date(a[a.length-1].period);e.push({label:`${l.toLocaleDateString("en-US",{day:"numeric",month:"short"})} - ${n.toLocaleDateString("en-US",{day:"numeric",month:"short"})}`,total:t})}}t=e.map(e=>e.label),l=e.map(e=>e.total)}N=new r.Ay(e,{type:"bar",data:{labels:t,datasets:[{label:"Spending",data:l,backgroundColor:n,borderColor:"#2ecc71",borderWidth:1,borderRadius:4,barPercentage:.6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return`₹${H(e.parsed.y)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"₹"+H(e)}}},x:{grid:{display:!1}}}}})}else console.error("No insights data available")}function ae(){if(V&&V.destroy(),!Y.value)return void console.error("Categories chart canvas not found");const e=Y.value.getContext("2d");if(!e)return void console.error("Failed to get 2D context for categories chart");if(!P.value||!P.value.monthly_pie)return void console.error("No category data available");const t=P.value.monthly_pie||[];V=new r.Ay(e,{type:"doughnut",data:{labels:t.map(e=>e.name),datasets:[{data:t.map(e=>e.total_spend),backgroundColor:B.slice(0,t.length),hoverOffset:4,borderWidth:1,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const t=e.raw,a=e.dataset.data.reduce((e,t)=>e+t,0),l=Math.round(t/a*100);return`₹${H(t)} (${l}%)`}}}}}})}const le=(0,s.KR)([]),ne=(0,l.EW)(()=>{const e=new Map;return le.value.forEach(t=>{const a=`${t.anomaly_type}-${t.related_data.period_end_date}`;(!e.has(a)||new Date(t.alert_timestamp)>new Date(e.get(a).alert_timestamp))&&e.set(a,t)}),Array.from(e.values())});async function se(){try{const e=await o.A.get("/trends/anomaly");le.value=e.data}catch(e){console.error("Error fetching anomaly data:",e)}}function oe(e){const t=10,a=50;if(!le.value||0===le.value.length)return t;const l=Math.max(...le.value.flatMap(e=>[e.related_data.current_period_spend,e.related_data.previous_period_spend]));return l?t+e/l*(a-t):t}function re(e){if(!e)return 0;const t=e.current_period_spend||0,a=e.previous_period_spend||1,l=(t-a)/a*100;return Math.round(l)}function ie(e){return e?i.Ay.formatDate(e,"MMM D, YYYY"):""}function ce(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}return(0,l.wB)(a,()=>{P.value&&te()}),(0,l.sV)(async()=>{await Promise.all([J(),se()])}),(e,s)=>{const o=(0,l.g2)("q-icon"),r=(0,l.g2)("q-card-section"),i=(0,l.g2)("q-card"),P=(0,l.g2)("q-tab"),N=(0,l.g2)("q-tabs"),V=(0,l.g2)("q-separator"),J=(0,l.g2)("q-avatar"),ee=(0,l.g2)("q-item-section"),te=(0,l.g2)("q-item-label"),ae=(0,l.g2)("q-item"),se=(0,l.g2)("q-list"),de=(0,l.g2)("q-spinner-dots"),ue=(0,l.g2)("q-page");return(0,l.uX)(),(0,l.Wv)(ue,{class:"insights-bg q-pa-md"},{default:(0,l.k6)(()=>[t.value?((0,l.uX)(),(0,l.CE)("div",K,[(0,l.bF)(de,{color:"primary",size:"80px"})])):((0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("div",d,[(0,l.Lk)("div",u,[(0,l.bF)(i,{class:"stats-card"},{default:(0,l.k6)(()=>[(0,l.bF)(r,null,{default:(0,l.k6)(()=>[s[1]||(s[1]=(0,l.Lk)("div",{class:"text-subtitle1 text-grey-7"},"Monthly Spending",-1)),(0,l.Lk)("div",v," ₹"+(0,n.v_)(H(G.value)),1),(0,l.Lk)("div",{class:(0,n.C4)(["trend-indicator q-mt-xs",Z.value.color])},[(0,l.bF)(o,{name:Z.value.icon,size:"16px"},null,8,["name"]),(0,l.Lk)("span",m,(0,n.v_)(Z.value.text),1)],2)]),_:1,__:[1]}),(0,l.Lk)("div",p,[(0,l.bF)(o,{name:"attach_money",color:"white",size:"24px"})])]),_:1})]),(0,l.Lk)("div",g,[(0,l.bF)(i,{class:"stats-card"},{default:(0,l.k6)(()=>[(0,l.bF)(r,null,{default:(0,l.k6)(()=>[s[3]||(s[3]=(0,l.Lk)("div",{class:"text-subtitle1 text-grey-7"},"Receipts Processed",-1)),(0,l.Lk)("div",y,(0,n.v_)(j.value),1),(0,l.Lk)("div",b,[(0,l.bF)(o,{name:"trending_up",size:"16px"}),s[2]||(s[2]=(0,l.Lk)("span",{class:"q-ml-xs"},"+23 this week",-1))])]),_:1,__:[3]}),(0,l.Lk)("div",h,[(0,l.bF)(o,{name:"receipt_long",color:"white",size:"24px"})])]),_:1})]),(0,l.Lk)("div",_,[(0,l.bF)(i,{class:"stats-card"},{default:(0,l.k6)(()=>[(0,l.bF)(r,null,{default:(0,l.k6)(()=>[s[4]||(s[4]=(0,l.Lk)("div",{class:"text-subtitle1 text-grey-7"},"Savings Potential",-1)),(0,l.Lk)("div",k," ₹"+(0,n.v_)(H(X.value)),1),s[5]||(s[5]=(0,l.Lk)("div",{class:"trend-indicator q-mt-xs text-grey-7"},[(0,l.Lk)("span",null,"AI identified")],-1))]),_:1,__:[4,5]}),(0,l.Lk)("div",f,[(0,l.bF)(o,{name:"savings",color:"white",size:"24px"})])]),_:1})])]),(0,l.Lk)("div",x,[(0,l.Lk)("div",L,[(0,l.bF)(i,{class:"chart-card"},{default:(0,l.k6)(()=>[(0,l.bF)(r,{class:"q-pb-none"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",F,[(0,l.bF)(o,{name:"trending_up",color:"green-7",size:"24px",class:"q-mr-sm"}),s[6]||(s[6]=(0,l.Lk)("div",{class:"text-h6 text-weight-medium"},"Spending Trends",-1))])]),_:1}),(0,l.bF)(r,null,{default:(0,l.k6)(()=>[(0,l.bF)(N,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),class:"text-grey","active-color":"primary","indicator-color":"primary","narrow-indicator":"",dense:"",align:"left"},{default:(0,l.k6)(()=>[(0,l.bF)(P,{name:"daily",label:"Daily"}),(0,l.bF)(P,{name:"weekly",label:"Weekly"}),(0,l.bF)(P,{name:"monthly",label:"Monthly"}),(0,l.bF)(P,{name:"yearly",label:"Yearly"})]),_:1},8,["modelValue"]),(0,l.Lk)("div",w,[(0,l.Lk)("canvas",{ref_key:"spendingTrendsChartRef",ref:U},null,512)])]),_:1})]),_:1})]),(0,l.Lk)("div",q,[(0,l.bF)(i,{class:"chart-card"},{default:(0,l.k6)(()=>[(0,l.bF)(r,{class:"q-pb-none"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",A,[(0,l.bF)(o,{name:"donut_large",color:"green-7",size:"24px",class:"q-mr-sm"}),s[7]||(s[7]=(0,l.Lk)("div",{class:"text-h6 text-weight-medium"}," This Month's Categories ",-1))])]),_:1}),(0,l.bF)(r,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",C,[(0,l.Lk)("canvas",{ref_key:"categoriesPieChartRef",ref:Y},null,512)])]),_:1}),(0,l.bF)(r,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",S,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(O.value,(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"category-item"},[(0,l.Lk)("div",{class:"category-dot",style:(0,n.Tr)({backgroundColor:B[t%B.length]})},null,4),(0,l.Lk)("div",D,(0,n.v_)(e.name),1),(0,l.Lk)("div",E," ₹"+(0,n.v_)(H(e.total_spend)),1)]))),128))])]),_:1})]),_:1})])]),le.value.length>0?((0,l.uX)(),(0,l.CE)("div",Q,[(0,l.Lk)("div",R,[(0,l.bF)(i,{class:"anomaly-card dashboard-card"},{default:(0,l.k6)(()=>[(0,l.bF)(r,{class:"q-pb-none"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",I,[(0,l.bF)(o,{name:"warning_amber",color:"amber-8",size:"26px",class:"q-mr-sm"}),s[8]||(s[8]=(0,l.Lk)("div",{class:"text-h6 text-weight-medium"}," Spending Anomalies Detected ",-1))])]),_:1}),(0,l.bF)(V,{spaced:"",inset:""}),(0,l.bF)(r,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",T,[(0,l.bF)(se,{separator:""},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ne.value,e=>((0,l.uX)(),(0,l.Wv)(ae,{key:e.anomaly_id,class:"anomaly-item"},{default:(0,l.k6)(()=>[(0,l.bF)(ee,{avatar:""},{default:(0,l.k6)(()=>[(0,l.bF)(J,{color:"red-2","text-color":"negative",icon:"trending_up"})]),_:1}),(0,l.bF)(ee,null,{default:(0,l.k6)(()=>[(0,l.bF)(te,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(e.anomaly_description),1)]),_:2},1024),(0,l.bF)(te,{caption:""},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(ie(e.related_data?.period_end_date||""))+" • "+(0,n.v_)(ce(e.related_data?.period_type||""))+"ly spending ",1)]),_:2},1024)]),_:2},1024),(0,l.bF)(ee,{side:""},{default:(0,l.k6)(()=>[(0,l.Lk)("div",W,[(0,l.Lk)("div",M,[(0,l.Lk)("div",{class:"bar previous",style:(0,n.Tr)({height:oe(e.related_data.previous_period_spend)+"px"})},null,4),(0,l.Lk)("div",{class:"bar current",style:(0,n.Tr)({height:oe(e.related_data.current_period_spend)+"px"})},null,4)]),(0,l.Lk)("div",z,[(0,l.Lk)("span",$,"+"+(0,n.v_)(re(e.related_data))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1})])])):(0,l.Q3)("",!0)]))]),_:1})}}};var X=a(2968),U=a(5013),Y=a(3341),N=a(222),V=a(3933),B=a(8805),j=a(3467),G=a(6915),O=a(3766),Z=a(2589),H=a(4958),J=a(5305),ee=a(1420),te=a(3079),ae=a(272),le=a.n(ae);const ne=(0,X.A)(P,[["__scopeId","data-v-25972e8c"]]),se=ne;le()(P,"components",{QPage:U.A,QCard:Y.A,QCardSection:N.A,QIcon:V.A,QTabs:B.A,QTab:j.A,QSeparator:G.A,QList:O.A,QItem:Z.A,QItemSection:H.A,QAvatar:J.A,QItemLabel:ee.A,QSpinnerDots:te.A})},6308:(e,t,a)=>{a.d(t,{A:()=>r});var l=a(9100);const n="http://localhost:8000/api/v1",s=!1,o=l.A.create({baseURL:n});o.interceptors.request.use(e=>{if(!s){const t=localStorage.getItem("sessionToken");t&&(e.headers.Authorization=`Bearer ${t}`)}return e},e=>Promise.reject(e));const r=o}}]);